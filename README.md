
# gh-ost-batch
A simple tool to run github/gh-ost to run multiple DDLs one after another (by batch).

## Motivation
github/gh-ost is a great tool for us to achieve zero downtime schema change, but its interface only allow us to execute one DDL at a time. Sometimes the SQL queries are generated by ORM tools (e.g. Django ORM), so multiple DDLs (and even DMLs) are mixed in same SQL file. This tool is for us to run it more smoothly.

## Usage
```
docker run gh-ost-batch \
    -master-host MASTER_HOST \
    -master-port MASTER_PORT \
    -repl-host REPL_HOST \
    -repl-port REPL_PORT \
    -db DB \
    -user USER \
    -pwd PWD \
    your.sql
```

## Example
1. Download [mysql_random_data_load](https://github.com/Percona-Lab/mysql_random_data_load/releases) according to your os version
2. Enter example folder: `cd ./example`
3. Create folder for local MySQL DBs: `mkdir -p leader-db follower-db`
4. Launch mysql leader & follower locally: `docker-compose up`
5. Generate fake data for experiments: `./mysql_random_data_load -h 127.0.0.1 -P 3306 -u user -p 0000 demo user 100000`
6. Run gh-ost batch script by
```
docker run --network mysql-cluster gh-ost-batch \
    -master-host MASTER_HOST \
    -master-port MASTER_PORT \
    -repl-host REPL_HOST \
    -repl-port REPL_PORT \
    -db DB \
    -user USER \
    -pwd PWD \
    example.sql
```

docker run -it \
    --mount type=bind,source="$(pwd)"/example.sql,target=/example.sql \
    --network mysql-cluster gh-ost-batch \
    -master-host MASTER_HOST \
    -master-port MASTER_PORT \
    -repl-host REPL_HOST \
    -repl-port REPL_PORT \
    -db DB \
    -user USER \
    -pwd PWD \
    example.sql